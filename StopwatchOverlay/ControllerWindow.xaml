<Window x:Class="StopwatchOverlay.ControllerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Stopwatch Controller" 
        Height="920" Width="680"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        MinWidth="640" MinHeight="700"
        Closing="Window_Closing">
    
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,5">
            <Image Source="pack://application:,,,/stopwatch.ico" Width="28" Height="28" Margin="0,0,8,0" VerticalAlignment="Center"/>
            <TextBlock Text="Stopwatch Overlay" 
                       FontSize="22" FontWeight="Bold" 
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Mode Selection -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
            <RadioButton x:Name="StopwatchModeRadio" Content="Stopwatch" 
                         IsChecked="True" GroupName="Mode"
                         Checked="ModeRadio_Checked" Margin="0,0,15,0"/>
            <RadioButton x:Name="ClockModeRadio" Content="Clock" 
                         GroupName="Mode"
                         Checked="ModeRadio_Checked" Margin="0,0,15,0"/>
            <RadioButton x:Name="CountdownModeRadio" Content="Countdown" 
                         GroupName="Mode"
                         Checked="ModeRadio_Checked" Margin="0,0,15,0"/>
            <RadioButton x:Name="TimecodeModeRadio" Content="Timecode" 
                         GroupName="Mode"
                         Checked="ModeRadio_Checked"/>
        </StackPanel>

        <!-- Countdown Duration (only visible in countdown mode) -->
        <StackPanel x:Name="CountdownPanel" Grid.Row="2" Orientation="Horizontal" 
                    HorizontalAlignment="Center" Margin="0,0,0,10" Visibility="Collapsed">
            <TextBlock Text="Duration: " Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" VerticalAlignment="Center"/>
            <TextBox x:Name="CountdownMinutes" Width="40" Text="5" 
                     TextAlignment="Center" VerticalContentAlignment="Center"/>
            <TextBlock Text=" min " Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" VerticalAlignment="Center"/>
            <TextBox x:Name="CountdownSeconds" Width="40" Text="00" 
                     TextAlignment="Center" VerticalContentAlignment="Center"/>
            <TextBlock Text=" sec" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Current Time Display -->
        <Border Grid.Row="3" Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}" 
                CornerRadius="8" Padding="15" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Ellipse x:Name="RecIndicator" Grid.Column="0" Width="16" Height="16" 
                         Fill="Red" Margin="0,0,10,0" Visibility="Collapsed"/>
                <TextBlock x:Name="TimeDisplay" Grid.Column="1"
                           Text="00:00:00.0" 
                           FontSize="38" 
                           FontFamily="Consolas"
                           FontWeight="Bold"
                           Foreground="#00D4FF" 
                           HorizontalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Control Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
            <Button x:Name="StartStopButton" Content="â–¶ Start (Win+F5)" Width="175" 
                    Style="{StaticResource StartButton}" 
                    Click="StartStopButton_Click" Margin="0,0,8,0"/>
            <Button x:Name="ResetButton" Content="â†º Reset (Win+F6)" Width="175" 
                    Style="{StaticResource ModernButton}" 
                    Click="ResetButton_Click"/>
        </StackPanel>

        <!-- Overlay and Lap Buttons -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,6">
            <Button x:Name="ToggleOverlayButton" Content="ðŸ‘ Show (Win+F7)" Width="175" 
                    Style="{StaticResource ModernButton}" 
                    Click="ToggleOverlayButton_Click" Margin="0,0,8,0"/>
            <Button x:Name="LapButton" Content="ðŸ Lap (Win+F8)" Width="175" 
                    Style="{StaticResource ModernButton}" 
                    Click="LapButton_Click"/>
        </StackPanel>

        <!-- Options Row -->
        <WrapPanel Grid.Row="6" HorizontalAlignment="Center" Margin="0,0,0,6">
            <CheckBox x:Name="AutoStartCheckBox" Content="Auto-start on show" 
                      Margin="0,0,15,0"/>
            <CheckBox x:Name="ShowRecIndicatorCheckBox" Content="REC indicator" 
                      Checked="ShowRecIndicatorCheckBox_Changed" 
                      Unchecked="ShowRecIndicatorCheckBox_Changed" Margin="0,0,15,0"/>
            <CheckBox x:Name="ClickThroughCheckBox" Content="Click-through" 
                      Checked="ClickThroughCheckBox_Changed" 
                      Unchecked="ClickThroughCheckBox_Changed" Margin="0,0,15,0"/>
            <CheckBox x:Name="BlinkColonCheckBox" Content="Blink colon" 
                      Margin="0,0,0,0"/>
        </WrapPanel>

        <!-- Settings Expander -->
        <Expander Grid.Row="7" Header="Settings" IsExpanded="True" Margin="0,0,0,6">
            <StackPanel>
                <!-- Screen and Position -->
                <TextBlock Text="Screen &amp; Position" FontSize="13" FontWeight="SemiBold" Opacity="0.7" Margin="0,4,0,6"/>
                <Grid Margin="4,0,4,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Theme:" 
                                   VerticalAlignment="Center" Margin="0,0,10,5"/>
                        <ComboBox Grid.Row="0" Grid.Column="1" x:Name="ThemeModeSelector" 
                                  SelectionChanged="ThemeModeSelector_SelectionChanged"
                                  Margin="0,0,0,5">
                            <ComboBoxItem Content="Dark" IsSelected="True"/>
                            <ComboBoxItem Content="Light"/>
                            <ComboBoxItem Content="System"/>
                        </ComboBox>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Screen:" 
                                   VerticalAlignment="Center" Margin="0,0,10,5"/>
                        <ComboBox Grid.Row="1" Grid.Column="1" x:Name="ScreenSelector" 
                                  SelectionChanged="ScreenSelector_SelectionChanged"
                                  Margin="0,0,0,5"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Position:" 
                                   VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <ComboBox Grid.Row="2" Grid.Column="1" x:Name="PositionSelector" 
                                  SelectionChanged="PositionSelector_SelectionChanged">
                            <ComboBoxItem Content="Top Left"/>
                            <ComboBoxItem Content="Top Center" IsSelected="True"/>
                            <ComboBoxItem Content="Top Right"/>
                            <ComboBoxItem Content="Bottom Left"/>
                            <ComboBoxItem Content="Bottom Center"/>
                            <ComboBoxItem Content="Bottom Right"/>
                        </ComboBox>
                </Grid>

                <!-- Appearance -->
                <TextBlock Text="Appearance" FontSize="13" FontWeight="SemiBold" Opacity="0.7" Margin="0,4,0,6"/>
                <Grid Margin="4,0,4,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Text:" 
                                   VerticalAlignment="Center" Margin="0,0,5,5"/>
                        <ComboBox Grid.Row="0" Grid.Column="1" x:Name="TextColorSelector" 
                                  SelectionChanged="AppearanceChanged" Margin="0,0,10,5">
                            <ComboBoxItem Content="White" IsSelected="True"/>
                            <ComboBoxItem Content="Yellow"/>
                            <ComboBoxItem Content="Cyan"/>
                            <ComboBoxItem Content="Lime"/>
                            <ComboBoxItem Content="Orange"/>
                            <ComboBoxItem Content="Red"/>
                            <ComboBoxItem Content="Magenta"/>
                        </ComboBox>

                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Border:" 
                                   VerticalAlignment="Center" Margin="0,0,5,5"/>
                        <ComboBox Grid.Row="0" Grid.Column="3" x:Name="BorderColorSelector" 
                                  SelectionChanged="AppearanceChanged" Margin="0,0,0,5">
                            <ComboBoxItem Content="Black" IsSelected="True"/>
                            <ComboBoxItem Content="White"/>
                            <ComboBoxItem Content="Dark Gray"/>
                            <ComboBoxItem Content="Red"/>
                            <ComboBoxItem Content="Blue"/>
                        </ComboBox>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Font:" 
                                   VerticalAlignment="Center" Margin="0,0,5,5"/>
                        <ComboBox Grid.Row="1" Grid.Column="1" x:Name="FontSelector" 
                                  SelectionChanged="AppearanceChanged" Margin="0,0,10,5">
                            <ComboBoxItem Content="Consolas" IsSelected="True"/>
                            <ComboBoxItem Content="Segoe UI"/>
                            <ComboBoxItem Content="Arial"/>
                            <ComboBoxItem Content="Courier New"/>
                            <ComboBoxItem Content="Lucida Console"/>
                            <ComboBoxItem Content="Cascadia Mono"/>
                        </ComboBox>

                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Format:" 
                                   VerticalAlignment="Center" Margin="0,0,5,5"/>
                        <ComboBox Grid.Row="1" Grid.Column="3" x:Name="TimeFormatSelector" 
                                  SelectionChanged="TimeFormatSelector_SelectionChanged" Margin="0,0,0,5">
                            <ComboBoxItem Content="HH:MM:SS.t" IsSelected="True"/>
                            <ComboBoxItem Content="HH:MM:SS"/>
                            <ComboBoxItem Content="MM:SS.t"/>
                            <ComboBoxItem Content="MM:SS"/>
                        </ComboBox>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Size:" 
                                   VerticalAlignment="Center" Margin="0,0,5,5"/>
                        <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,0,10,5">
                            <Slider x:Name="TextSizeSlider" Width="100" Minimum="24" Maximum="120" Value="48"
                                    VerticalAlignment="Center" ValueChanged="AppearanceSliderChanged"/>
                            <TextBlock x:Name="TextSizeLabel" Text="48" 
                                       VerticalAlignment="Center" Margin="5,0,0,0" Width="25"/>
                        </StackPanel>

                        <TextBlock Grid.Row="2" Grid.Column="2" Text="Outline:" 
                                   VerticalAlignment="Center" Margin="0,0,5,5"/>
                        <StackPanel Grid.Row="2" Grid.Column="3" Orientation="Horizontal" Margin="0,0,0,5">
                            <Slider x:Name="BorderWidthSlider" Width="100" Minimum="1" Maximum="5" Value="2"
                                    VerticalAlignment="Center" ValueChanged="AppearanceSliderChanged"/>
                            <TextBlock x:Name="BorderWidthLabel" Text="2" 
                                       VerticalAlignment="Center" Margin="5,0,0,0" Width="25"/>
                        </StackPanel>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="BG:" 
                                   VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <StackPanel Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="3" Orientation="Horizontal">
                            <Slider x:Name="BackgroundOpacitySlider" Width="200" Minimum="0" Maximum="100" Value="50"
                                    VerticalAlignment="Center" ValueChanged="AppearanceSliderChanged"/>
                            <TextBlock x:Name="BackgroundOpacityLabel" Text="50%" 
                                       VerticalAlignment="Center" Margin="5,0,0,0" Width="35"/>
                        </StackPanel>
                </Grid>

                <!-- Light Ring -->
                <TextBlock Text="Light Ring (Screen Border)" FontSize="13" FontWeight="SemiBold" Opacity="0.7" Margin="0,8,0,6"/>
                <Grid Margin="4,0,4,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <CheckBox Grid.Row="0" Grid.Column="0" x:Name="LightRingCheckBox" 
                              Content="Enable" VerticalAlignment="Center" Margin="0,0,15,5"
                              Checked="LightRingCheckBox_Changed" Unchecked="LightRingCheckBox_Changed"/>
                    
                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Brightness:" 
                               VerticalAlignment="Center" Margin="0,0,5,5"/>
                    <StackPanel Grid.Row="0" Grid.Column="3" Orientation="Horizontal" Margin="0,0,0,5">
                        <Slider x:Name="LightRingBrightnessSlider" Width="120" Minimum="10" Maximum="100" Value="100"
                                VerticalAlignment="Center" ValueChanged="LightRingSliderChanged"/>
                        <TextBlock x:Name="LightRingBrightnessLabel" Text="100%" 
                                   VerticalAlignment="Center" Margin="5,0,0,0" Width="40"/>
                    </StackPanel>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Width:" 
                               VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal">
                        <Slider x:Name="LightRingWidthSlider" Width="80" Minimum="5" Maximum="100" Value="20"
                                VerticalAlignment="Center" ValueChanged="LightRingSliderChanged"/>
                        <TextBlock x:Name="LightRingWidthLabel" Text="20px" 
                                   VerticalAlignment="Center" Margin="5,0,0,0" Width="40"/>
                    </StackPanel>

                    <CheckBox Grid.Row="1" Grid.Column="2" Grid.ColumnSpan="2" x:Name="LightRingHideFromCaptureCheckBox" 
                              Content="Hide from screen capture" VerticalAlignment="Center" Margin="10,0,0,0"
                              ToolTip="Makes the light ring invisible to screen recorders (Windows 10 2004+)"
                              Checked="LightRingSliderChanged" Unchecked="LightRingSliderChanged"/>
                </Grid>
            </StackPanel>
        </Expander>

        <!-- Lap Times -->
        <GroupBox Grid.Row="8" Header="Lap Times">
            <Grid>
                <ListBox x:Name="LapListBox" 
                         BorderThickness="0" MaxHeight="100"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" FontFamily="Consolas"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <TextBlock x:Name="LapPlaceholder" Text="Press Win+F8 or click Lap to record split times" 
                           Opacity="0.4" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>
        </GroupBox>

        <!-- Status Bar -->
        <Border Grid.Row="9" CornerRadius="4" Padding="8" Margin="0,6,0,0"
                Background="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Ellipse x:Name="StatusIndicator" Width="10" Height="10" Fill="Gray" Margin="0,0,8,0"/>
                    <TextBlock x:Name="StatusText" Text="Ready" Opacity="0.6" FontSize="12"/>
                </StackPanel>
                <TextBlock Grid.Column="1" Text="Win+F5 Start/Stop  Win+F6 Reset  Win+F7 Overlay  Win+F8 Lap" 
                           Opacity="0.35" FontSize="10"/>
            </Grid>
        </Border>
    </Grid>
</Window>
